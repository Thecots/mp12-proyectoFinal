<form>
  <main class="crearpost">
    <h1>Nuevo mensaje</h1>
    <h2>Tema: <a style="color: rgb(255, 45, 8);" href="/foro/tema/<%= data.foroid%>/<%=data.postid%>/1/"><%= data.posttitle%></a></h2>
    <div class="edtior comenteditor" data-tiny-editor>
      <textarea class=".__editor" required minlength="5" maxlength="150"></textarea>
      <div class="totalletters">150 caracteres restantes</div>
    </div>
    <input type="text"  id="postid" hidden value="<%= data.postid %>">
    <button class="button" type="submit">Publicar mensaje</button>
  </main>
</form>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.querySelector('form').addEventListener('submit', e => {
    e.preventDefault();
    titulo = document.querySelector('.title');
    content = document.querySelector('textarea');
    fetch('/comentar_post',
          {method: 'POST',
          body: JSON.stringify({
            postid: document.querySelector('#postid').value,
            content: document.querySelector('textarea').value
          }),
          headers:{
            'Content-Type': 'application/json'
          }}
        ).then(res => res.json())
        .then(res => {
         if(res.ok){
          Swal.fire(
            'Commentario guardado',
            '',
            'success',
          ).then(() => {
            window.location.href = `/foro/tema/<%= data.foroid%>/${document.querySelector("#postid").value}/1/`
          })
         }else{
          Swal.fire(
            'Ha ocurrido un error',
            '',
            'error',
            )
         }
      });
  })


  document.querySelector('textarea').addEventListener('keyup', e=> {
    x = document.querySelector('textarea')
    document.querySelector('.totalletters').innerHTML = 150-x.value.length
  })
</script>

